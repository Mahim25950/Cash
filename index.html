<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CashReward - Home</title>
    
    <script src='//libtl.com/sdk.js' data-zone='9356525' data-sdk='show_9356525'></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #121212; color: #ffffff; }
        .dark-bg { background-color: #121212; }
        .card-bg { background-color: #1e1e1e; }
        .border-accent { border-color: #ff8c00; }
        .text-accent { color: #ff8c00; }
        .btn, .btn-accent, .btn-outline-accent { transition: all 0.2s ease-in-out; transform: scale(1); }
        .btn:active, .btn-accent:active, .btn-outline-accent:active { transform: scale(0.95); }
        .btn-accent { background-color: #ff8c00; color: #121212; font-weight: bold; }
        .btn-accent:hover { background-color: #e67e00; }
        .btn-outline-accent { border: 1px solid #ff8c00; color: #ff8c00; }
        .btn-outline-accent:hover { background-color: #ff8c00; color: #121212; }
        .input-field { background-color: #2c2c2c; border: 1px solid #444; }
        .notification-dot {
            position: absolute; top: -2px; right: -2px; width: 10px; height: 10px;
            background-color: #ef4444; border-radius: 50%; border: 2px solid #121212; display: none;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen">
    <!-- Loader -->
    <div id="loader" class="fixed inset-0 dark-bg bg-opacity-75 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-accent"></div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="min-h-screen flex-col">
        <header class="flex items-center justify-between p-4 sticky top-0 bg-opacity-80 backdrop-blur-md z-10 dark-bg">
            <h1 class="text-xl font-bold">CashReward</h1>
            <div class="flex items-center space-x-4">
                <div id="notification-bell" class="relative cursor-pointer">
                    <i data-lucide="bell" class="w-6 h-6"></i>
                    <div id="notification-dot" class="notification-dot"></div>
                </div>
                <a href="profile.html" class="cursor-pointer">
                    <i data-lucide="user" class="w-6 h-6"></i>
                </a>
            </div>
        </header>

        <main class="flex-grow p-4 space-y-6">
            <div class="card-bg p-4 rounded-lg flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm">Your Balance</p>
                    <p class="text-3xl font-bold"><span id="coin-balance">0</span> Coins</p>
                </div>
                <button id="home-withdraw-btn" class="bg-white text-black font-semibold px-6 py-2 rounded-lg">Withdraw</button>
            </div>
            <section>
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-lg font-semibold">Daily Tasks</h2>
                        <p class="text-sm text-gray-400 mb-4">Complete tasks to get rewards.</p>
                    </div>
                    <p class="text-sm text-gray-400">Ads Left: <span id="ads-left-count">...</span></p>
                </div>
                <div class="space-y-3">
                    <div class="bg-orange-500 p-3 rounded-lg flex items-center justify-between text-black">
                        <div class="flex items-center space-x-3"><span class="text-3xl">ðŸ¤©</span><div><h3 class="font-bold">Watch Short Ad</h3><p class="text-xs font-medium">Rewarded Interstitial</p></div></div>
                        <button class="bg-white text-orange-500 font-bold px-6 py-2 rounded-lg text-sm btn" onclick="claimReward('interstitial')">Claim</button>
                    </div>
                    <div class="card-bg p-3 rounded-lg flex items-center justify-between">
                        <div class="flex items-center space-x-3"><span class="text-3xl">ðŸ˜Ž</span><div><h3 class="font-semibold">Click for Reward</h3><p class="text-xs text-gray-400">Rewarded Popup</p></div></div>
                        <button class="bg-white text-black font-bold px-6 py-2 rounded-lg text-sm btn" onclick="claimReward('popup')">Claim</button>
                    </div>
                     <div class="card-bg p-3 rounded-lg flex items-center justify-between">
                        <div class="flex items-center space-x-3"><span class="text-3xl">ðŸ‘€</span><div><h3 class="font-semibold">Watch a Video</h3><p class="text-xs text-gray-400">In-App Interstitial</p></div></div>
                        <button class="bg-gray-700 text-white font-bold px-6 py-2 rounded-lg text-sm btn" onclick="claimReward('inApp')">Start</button>
                    </div>
                    <div class="card-bg p-3 rounded-lg flex items-center justify-between">
                        <div class="flex items-center space-x-3"><span class="text-3xl">ðŸŽ®</span><div><h3 class="font-semibold">Play Mini App</h3><p class="text-xs text-gray-400">Get a big reward!</p></div></div>
                        <button class="bg-blue-500 text-white font-bold px-6 py-2 rounded-lg text-sm btn" onclick="claimReward('miniApp')">Play</button>
                    </div>
                </div>
            </section>
        </main>

        <nav class="sticky bottom-0 grid grid-cols-4 items-center text-center py-2 card-bg">
            <a href="index.html" class="flex flex-col items-center text-center py-2 text-accent">
                <i data-lucide="home" class="mx-auto w-6 h-6"></i>
                <span class="text-xs">Home</span>
            </a>
            <a href="top_earner.html" class="flex flex-col items-center text-center py-2 text-gray-400">
                <i data-lucide="trophy" class="mx-auto w-6 h-6"></i>
                <span class="text-xs">Top Earners</span>
            </a>
            <a href="wallet.html" class="flex flex-col items-center text-center py-2 text-gray-400">
                <i data-lucide="wallet" class="mx-auto w-6 h-6"></i>
                <span class="text-xs">Wallet</span>
            </a>
            <a href="refer_earn.html" class="flex flex-col items-center text-center py-2 text-gray-400">
                <i data-lucide="users" class="mx-auto w-6 h-6"></i>
                <span class="text-xs">Refer & Earn</span>
            </a>
        </nav>
    </div>
    
    <!-- Custom Alert -->
    <div id="custom-alert" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm text-center">
            <p id="alert-message" class="mb-4"></p>
            <button id="alert-ok-btn" class="btn-accent px-6 py-2 rounded-lg">OK</button>
        </div>
    </div>

    <script>
        // Telegram Web App initialization
        const tg = window.Telegram.WebApp;
        
        // Initialize the app
        tg.expand();
        tg.ready();
        
        // Get Telegram user data
        const user = tg.initDataUnsafe?.user;
        const userId = user?.id || Math.random().toString(36).substring(2);
        const userName = user?.first_name || 'Telegram User';
        
        let userData = null;
        let appConfig = {};

        const loader = document.getElementById('loader');
        const coinBalanceEl = document.getElementById('coin-balance');
        const adsLeftCountEl = document.getElementById('ads-left-count');
        const notificationDot = document.getElementById('notification-dot');

        window.onload = async () => {
            lucide.createIcons();
            setupEventListeners();
            await initializeUser();
            updateUI();
            loader.classList.add('hidden');
        };

        async function initializeUser() {
            // In a real implementation, you would fetch user data from your backend
            // For demo purposes, we'll create a mock user
            userData = {
                uid: userId,
                name: userName,
                balance: 150,
                referralCode: Math.random().toString(36).substring(2, 8).toUpperCase(),
                dailyAdCount: 0,
                lastAdWatchDate: new Date().toISOString().split('T')[0],
                isBlocked: false
            };
            
            appConfig = {
                minWithdrawal: 5000,
                paymentMethods: ["UPI", "bKash"],
                dailyAdLimit: 10,
                coinValueCoins: 1000,
                coinValueInr: 10
            };
            
            // Save to localStorage for demo
            localStorage.setItem('userData', JSON.stringify(userData));
            localStorage.setItem('appConfig', JSON.stringify(appConfig));
        }

        function updateUI() {
            if (!userData) return;
            const balance = userData.balance || 0;
            coinBalanceEl.textContent = balance.toLocaleString();
            updateAdsLeftCount();
        }

        function updateAdsLeftCount() {
            const today = new Date().toISOString().split('T')[0];
            if (userData.lastAdWatchDate !== today) {
                userData.dailyAdCount = 0;
            }
            const adsLeft = Math.max(0, (appConfig.dailyAdLimit || 10) - (userData.dailyAdCount || 0));
            adsLeftCountEl.textContent = adsLeft;
        }

        function setupEventListeners() {
            document.getElementById('home-withdraw-btn').addEventListener('click', () => {
                window.location.href = 'wallet.html';
            });
            
            document.getElementById('alert-ok-btn').addEventListener('click', () => {
                document.getElementById('custom-alert').classList.add('hidden');
            });
            
            document.getElementById('notification-bell').addEventListener('click', () => {
                showAlert("No new notifications");
            });
        }

        window.claimReward = async function(taskType) {
            const today = new Date().toISOString().split('T')[0];

            if (userData.lastAdWatchDate !== today) {
                userData.dailyAdCount = 0;
                userData.lastAdWatchDate = today;
            }

            if (userData.dailyAdCount >= (appConfig.dailyAdLimit || 10)) {
                return showAlert("You have reached your daily ad watch limit.");
            }
            
            if (typeof window.show_9356525 !== 'function') {
                return showAlert("Ad service is currently unavailable. Please try again later.");
            }
            
            let adPromise;
            loader.classList.remove('hidden');
            try {
                 switch(taskType) {
                    case 'interstitial': adPromise = window.show_9356525(); break;
                    case 'popup': adPromise = window.show_9356525('pop'); break;
                    case 'inApp': adPromise = window.show_9356525({ type: 'inApp', inAppSettings: { frequency: 2, capping: 0.1, interval: 30, timeout: 5, everyPage: false } }); break;
                    case 'miniApp': adPromise = window.show_9356525(); break;
                    default: return;
                }
                
                await adPromise;

                userData.dailyAdCount = (userData.dailyAdCount || 0) + 1;
                
                let rewardAmount = 0;
                if (taskType === 'miniApp') rewardAmount = 100;
                else if (taskType !== 'inApp') rewardAmount = 50;

                if (rewardAmount > 0) {
                    userData.balance += rewardAmount;
                    updateUI();
                    showAlert(`Congratulations! You have won ${rewardAmount} coins.`);
                }
                updateAdsLeftCount();

                // Save updated user data
                localStorage.setItem('userData', JSON.stringify(userData));

            } catch(e) {
                console.error("Ad error:", e);
                showAlert('Could not show ad. Please try again later.');
            } finally {
                loader.classList.add('hidden');
            }
        }

        function showAlert(message) {
            document.getElementById('alert-message').textContent = message;
            document.getElementById('custom-alert').classList.remove('hidden');
        }
        window.showAlert = showAlert;
    </script>
</body>
</html>
